<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelime Bildirim</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="https://via.placeholder.com/32" type="image/png">
    <style>
        /* ... (YukarÄ±da verdiÄŸim modern arayÃ¼z CSS kodlarÄ± buraya gelecek, aynÄ± bÄ±rak) ... */
        /* NOT: BurayÄ± kÄ±salttÄ±m, Ã¶nceki cevabÄ±mdaki CSS'yi buraya aynen koyabilirsin. */
    </style>
</head>
<body>
    <nav class="navbar">
        <button class="hamburger" onclick="toggleMenu()">â˜°</button>
        <h1>Kelime Bildirim</h1>
        <div class="nav-actions">
            <button class="toggle-mode-btn" onclick="toggleDarkMode()" title="KaranlÄ±k/AÃ§Ä±k Mod">ðŸŒ“</button>
        </div>
    </nav>
    <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="#add-word" onclick="showSection('add-word'); toggleMenu()">Kelime Ekle</a></li>
            <li><a href="#upload-file" onclick="showSection('upload-file'); toggleMenu()">Dosya YÃ¼kle</a></li>
            <li><a href="#notification-settings" onclick="showSection('notification-settings'); toggleMenu()">Bildirim AyarlarÄ±</a></li>
            <li><button onclick="clearAllWords(); toggleMenu()">TÃ¼mÃ¼nÃ¼ Sil</button></li>
            <li><button onclick="toggleDarkMode(); toggleMenu()">KaranlÄ±k/AÃ§Ä±k Mod</button></li>
        </ul>
    </div>
    <div class="container">
        <div class="card" id="add-word">
            <h2>Kelime Ekle</h2>
            <div class="input-group">
                <input type="text" id="wordInput" placeholder="Bir kelime girin">
                <input type="number" id="intervalInput" placeholder="Bildirim sÄ±klÄ±ÄŸÄ± (saniye)" min="5">
                <button onclick="addWord()">Ekle</button>
            </div>
        </div>
        <div class="card" id="upload-file" style="display: none;">
            <h2>Dosya YÃ¼kle</h2>
            <div class="input-group">
                <input type="file" id="fileInput" accept=".txt,.xlsx,.xls,.pdf,.json">
                <input type="number" id="wordCountInput" placeholder="KaÃ§ kelime yÃ¼klensin? (BoÅŸ = tÃ¼mÃ¼)" min="1">
                <select id="selectionMethod">
                    <option value="random">Rastgele</option>
                    <option value="first">Ä°lk N Kelime</option>
                    <option value="last">Son N Kelime</option>
                </select>
                <select id="categoryFilter">
                    <option value="">TÃ¼mÃ¼</option>
                </select>
                <button onclick="uploadFile()">Dosya YÃ¼kle</button>
            </div>
        </div>
        <div class="card" id="notification-settings" style="display: none;">
            <h2>Bildirim AyarlarÄ±</h2>
            <div class="input-group">
                <input type="number" id="notificationWordCount" placeholder="Bildirim yapÄ±lacak kelime sayÄ±sÄ± (BoÅŸ = tÃ¼mÃ¼)" min="1">
                <button onclick="updateNotifications()">Uygula</button>
            </div>
        </div>
        <div id="error" class="error"></div>
        <div class="card">
            <h2>Kelime Listesi</h2>
            <button class="clear-all-btn" onclick="clearAllWords()">TÃ¼mÃ¼nÃ¼ Sil</button>
            <ul id="wordList"></ul>
        </div>
    </div>
    <script>
    // --- JavaScript FONKSÄ°YONLARI BAÅžLANGIÃ‡ ---
    let words = JSON.parse(localStorage.getItem('words')) || [];
    let notificationIntervals = new Map();
    let editingIndex = null;
    let notificationWordCount = parseInt(localStorage.getItem('notificationWordCount')) || 0;

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('notificationWordCount').value = notificationWordCount || '';
        updateWordList();
        updateNotifications();
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js').catch(err => {
                console.error('Servis Ã§alÄ±ÅŸanÄ± kaydÄ± baÅŸarÄ±sÄ±z:', err);
                document.getElementById('error').textContent = 'Uygulama Ã§evrimdÄ±ÅŸÄ± desteÄŸi yÃ¼klenemedi.';
            });
        }
        if (!window.XLSX) {
            console.error('XLSX kÃ¼tÃ¼phanesi yÃ¼klenemedi.');
            document.getElementById('error').textContent = 'Excel dosyalarÄ± iÃ§in kÃ¼tÃ¼phane yÃ¼klenemedi.';
        }
        if (!window.pdfjsLib) {
            console.error('pdf.js kÃ¼tÃ¼phanesi yÃ¼klenemedi.');
            document.getElementById('error').textContent = 'PDF dosyalarÄ± iÃ§in kÃ¼tÃ¼phane yÃ¼klenemedi.';
        }
    });

    function toggleMenu() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('open');
    }

    function showSection(sectionId) {
        document.querySelectorAll('.card').forEach(card => {
            card.style.display = card.id === sectionId ? 'block' : 'none';
        });
    }

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    function isWordExists(word) {
        return words.some(w => w.word.toLowerCase() === word.toLowerCase());
    }

    function getSelectedItems(array, count, method) {
        if (!count || count >= array.length) return array;
        if (method === 'first') {
            return array.slice(0, count);
        } else if (method === 'last') {
            return array.slice(-count);
        } else {
            const shuffled = array.slice().sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }
    }

    function stopAllNotifications() {
        notificationIntervals.forEach((intervalId) => clearInterval(intervalId));
        notificationIntervals.clear();
    }

    function startNotifications(wordList) {
        stopAllNotifications();
        wordList.forEach(wordObj => {
            if (Notification.permission !== 'granted') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        const intervalId = showNotification(wordObj.word, wordObj.interval);
                        notificationIntervals.set(wordObj.word, intervalId);
                    } else {
                        alert('Bildirim izni verilmedi, alert kullanÄ±lacak.');
                        const intervalId = setInterval(() => alert(`HatÄ±rlatma: ${wordObj.word}`), wordObj.interval);
                        notificationIntervals.set(wordObj.word, intervalId);
                    }
                });
            } else {
                const intervalId = showNotification(wordObj.word, wordObj.interval);
                notificationIntervals.set(wordObj.word, intervalId);
            }
        });
    }

    function showNotification(word, interval) {
        return setInterval(() => {
            new Notification('Kelime HatÄ±rlatÄ±cÄ±', {
                body: `HatÄ±rlatma: ${word}`,
                icon: 'https://via.placeholder.com/32'
            });
        }, interval);
    }

    function updateNotifications() {
        const notificationWordCountInput = document.getElementById('notificationWordCount');
        const errorDiv = document.getElementById('error');
        const newCount = parseInt(notificationWordCountInput.value) || 0;

        if (notificationWordCountInput.value && (isNaN(newCount) || newCount < 1)) {
            errorDiv.textContent = 'LÃ¼tfen geÃ§erli bir bildirim kelime sayÄ±sÄ± girin!';
            return;
        }

        if (words.length === 0) {
            errorDiv.textContent = 'Ã–nce kelime yÃ¼kleyin!';
            return;
        }

        notificationWordCount = newCount;
        localStorage.setItem('notificationWordCount', notificationWordCount);
        errorDiv.textContent = '';

        const selectedWords = getSelectedItems(words, notificationWordCount, 'random');
        startNotifications(selectedWords);
    }

    function addWord() {
        const wordInput = document.getElementById('wordInput');
        const intervalInput = document.getElementById('intervalInput');
        const errorDiv = document.getElementById('error');
        const word = wordInput.value.trim();
        const interval = parseInt(intervalInput.value) * 1000;

        if (!word || !interval || interval < 5000) {
            errorDiv.textContent = 'LÃ¼tfen bir kelime ve en az 5 saniyelik bir sÃ¼re girin!';
            return;
        }

        if (isWordExists(word)) {
            errorDiv.textContent = 'Bu kelime zaten listede!';
            return;
        }

        errorDiv.textContent = '';
        const wordObj = { word, interval };
        words.push(wordObj);
        localStorage.setItem('words', JSON.stringify(words));
        updateWordList();
        updateNotifications();
        wordInput.value = '';
        intervalInput.value = '';
    }

    // uploadFile, handleTextFile, handleExcelFile, handlePDFFile, handleJSONFile
    // ... (Uzun kod, eski dosyandakiyle aynÄ± ÅŸekilde buraya eklemen yeterli)
    // EÄŸer tekrar paylaÅŸmamÄ± istersen, tamamÄ±nÄ± gÃ¶nderebilirim.

    // editWord, saveEdit, cancelEdit, deleteWord, clearAllWords, updateWordList
    // ... (AynÄ± ÅŸekilde eski fonksiyonlarÄ±n tamamÄ±nÄ± buraya koymalÄ±sÄ±n.)

    // --- JavaScript FONKSÄ°YONLARI BÄ°TÄ°Åž ---
    </script>
</body>
</html>
<script src="script.js"></script>
